# Skillix 项目设计

> 日期: 2026-01-11
> 来源: 从初步设计构想拆分
> 更新: 添加双仓库架构和技能市场设计，使用 Mermaid 流程图

---

## 一、项目概述

### 1.1 项目名称

**Skillix** (技能管理系统)

### 1.2 项目定位

Skillix 是一个基于 MCP (Model Context Protocol) 的技能管理系统，为 AI 编码代理（如 Cursor）提供技能的创建、管理、加载和进化能力。

### 1.3 核心理念

> "Skill + Mix = Skillix"
> 混合技能，智能赋能

### 1.4 项目目标

1. **简化技能管理** - 通过 MCP 工具原生集成，无需执行 Bash 命令
2. **智能分流** - 自动判断使用现有技能、改进技能或创建新技能
3. **支持技能进化** - AI 可以自动创建和更新技能
4. **技能市场** - 支持从 GitHub 技能源下载和共享技能
5. **全局/项目技能** - 区分全局技能和项目级技能
6. **兼容 Anthropic 规范** - 100% 兼容 SKILL.md 格式
7. **跨平台支持** - 支持 Cursor、Claude Code 等多种 AI 编码工具

### 1.5 与 SkillForge 的区别

| 方面 | SkillForge | Skillix |
|------|------------|---------|
| 定位 | 元技能（用于创建技能） | MCP Server（管理技能） |
| 实现方式 | SKILL.md + Python 脚本 | MCP 工具调用 |
| 运行环境 | Claude Code CLI | Cursor + MCP |
| 核心功能 | 技能创建流程 | 技能 CRUD + 市场 + 管理 |
| 技能来源 | 本地 | 本地 + GitHub 技能市场 |

---

## 二、双仓库架构

### 2.1 仓库规划

Skillix 采用**双仓库架构**：

| 仓库 | GitHub 名称 | npm 包名 | 说明 |
|------|-------------|----------|------|
| **MCP Server 仓库** | `skillix-mcp` | `skillix-mcp` | MCP Server 实现，通过 npx 运行 |
| **技能中心仓库** | `skillix-hub` | - | 官方技能中心，存放可共享的技能 |

> **当前状态**：GitHub 仓库已命名为 `skillix-mcp`，与 npm 包名保持一致。

### 2.2 架构图

```mermaid
graph TB
    subgraph GitHub["GitHub"]
        subgraph MCP["skillix-mcp<br/>(MCP Server)"]
            MCP1["npx skillix-mcp"]
            MCP2["MCP 工具实现"]
            MCP3["技能管理逻辑"]
        end
        
        subgraph Skills["skillix-hub<br/>(官方技能中心)"]
            S1["skills/pdf/SKILL.md"]
            S2["skills/xlsx/SKILL.md"]
            S3["skills/docx/SKILL.md"]
        end
        
        subgraph Third["第三方技能源<br/>(可选)"]
            T1["user/custom-skills"]
        end
    end
    
    subgraph Local["本地环境"]
        subgraph Global["全局配置<br/>~/.skillix/"]
            G1["config.json<br/>(技能源列表)"]
            G2["skills/<br/>(全局技能目录)"]
        end
        
        subgraph Project["项目目录<br/>project/"]
            P1[".skillix/config.json<br/>(项目配置)"]
            P2[".skillix/skills/<br/>(项目级技能)"]
        end
    end
    
    MCP --> |npx| Local
    Skills --> |sx_install| G2
    Skills --> |sx_install| P2
    Third --> |sx_install| G2
    Third --> |sx_install| P2
    Project -.-> |本地优先查找| Global
```

> **说明**：
> - 官方技能市场和第三方技能源的技能都可以安装到**全局**或**项目级**目录
> - 用户可以在安装时通过 `scope` 参数选择安装位置
> - 采用**本地优先策略**：项目级技能优先于全局技能
> - 项目配置和全局配置相互独立，不进行合并

### 2.4 技能来源优先级

```mermaid
flowchart LR
    A[查找技能] --> B{项目级技能?}
    B -->|找到| C[使用项目技能]
    B -->|未找到| D{全局技能?}
    D -->|找到| E[使用全局技能]
    D -->|未找到| F{技能市场?}
    F -->|找到| G[提示安装]
    F -->|未找到| H[建议创建]
    
    style C fill:#90EE90
    style E fill:#87CEEB
    style G fill:#FFD700
    style H fill:#FFA07A
```

---

## 三、命名规范

### 3.1 仓库命名

| 类型 | 名称 | 说明 |
|------|------|------|
| MCP Server | `skillix-mcp` | npm 包，通过 npx 运行 |
| 技能中心 | `skillix-hub` | 官方技能仓库 |
| 项目名 | **Skillix** | 技能管理系统 |

### 3.2 目录命名

| 类型 | 路径 | 说明 |
|------|------|------|
| 全局配置 | `~/.skillix/config.json` | 全局配置文件 |
| 全局技能 | `~/.skillix/skills/` | 全局技能目录 |
| 项目配置 | `.skillix/config.json` | 项目级配置 |
| 项目技能 | `.skillix/skills/` | 项目级技能目录 |

### 3.3 MCP 工具命名

> **设计原则**：考虑到 Cursor MCP 的工具数量限制，采用**合并策略**，将相关功能整合到同一工具中，通过 `action` 参数区分操作。

#### 3.3.1 精简版工具列表（推荐，5个工具）

| 工具名 | 说明 | 包含操作 |
|--------|------|----------|
| `sx-triage` | 智能分流 | 分析任务，推荐技能 |
| `sx-skill` | **技能管理** | list, read, create, update, delete |
| `sx-market` | **市场操作** | search, install, uninstall |
| `sx-config` | **配置管理** | init, sources (list/add/remove) |
| `sx-help` | **帮助信息** | 显示使用说明和示例 |

#### 3.3.2 完整版工具列表（11个工具）

如果工具数量限制允许，可以使用更细粒度的工具：

| 工具名 | 说明 |
|--------|------|
| `sx-triage` | 智能分流 |
| `sx_init` | 初始化项目配置 |
| `sx_list` | 列出所有技能 |
| `sx_read` | 读取技能内容 |
| `sx_create` | 创建新技能 |
| `sx_update` | 更新技能 |
| `sx_delete` | 删除技能 |
| `sx_install` | 从技能市场安装技能 |
| `sx_uninstall` | 卸载技能 |
| `sx_search` | 搜索技能市场 |
| `sx_sources` | 管理技能源 |

#### 3.3.3 工具合并对照表

```mermaid
flowchart LR
    subgraph Full["完整版 (11个)"]
        F1["sx_list"]
        F2["sx_read"]
        F3["sx_create"]
        F4["sx_update"]
        F5["sx_delete"]
        F6["sx_search"]
        F7["sx_install"]
        F8["sx_uninstall"]
        F9["sx_init"]
        F10["sx_sources"]
    end
    
    subgraph Compact["精简版 (5个)"]
        C1["sx-skill"]
        C2["sx-market"]
        C3["sx-config"]
    end
    
    F1 --> C1
    F2 --> C1
    F3 --> C1
    F4 --> C1
    F5 --> C1
    F6 --> C2
    F7 --> C2
    F8 --> C2
    F9 --> C3
    F10 --> C3
    
    style C1 fill:#90EE90
    style C2 fill:#87CEEB
    style C3 fill:#FFD700
```

---

## 四、系统架构

### 4.1 整体架构

```mermaid
graph TB
    subgraph IDE["Cursor IDE"]
        subgraph MCP["MCP Protocol Layer"]
            subgraph Server["Skillix MCP Server"]
                subgraph Core["Core Tools"]
                    T1["sx-triage<br/>(智能分流)"]
                    T2["sx_list<br/>(列出技能)"]
                    T3["sx_read<br/>(读取技能)"]
                    T4["sx_create<br/>(创建技能)"]
                    T5["sx_update<br/>(更新技能)"]
                    T6["sx_delete<br/>(删除技能)"]
                end
                
                subgraph Market["Market Tools"]
                    M1["sx_install<br/>(安装技能)"]
                    M2["sx_uninstall<br/>(卸载技能)"]
                    M3["sx_search<br/>(搜索技能)"]
                    M4["sx_sources<br/>(管理技能源)"]
                end
                
                R["Resources<br/>skill://{scope}/{name}"]
            end
        end
        
        GS["Global Skills<br/>~/.skillix/skills/"]
        PS["Project Skills<br/>./.skillix/skills/"]
    end
    
    Server --> GS
    Server --> PS
```

### 4.2 智能分流机制

```mermaid
flowchart TD
    A[用户输入] --> B[sx-triage 工具]
    B --> C{分析结果}
    C -->|USE_EXISTING| D[调用 sx_read<br/>使用现有技能]
    C -->|IMPROVE_EXISTING| E[调用 sx_update<br/>改进现有技能]
    C -->|CREATE_NEW| F[调用 sx_create<br/>创建新技能]
    C -->|COMPOSE| G[返回技能列表<br/>组合多个技能]
    C -->|INSTALL| H[调用 sx_install<br/>从市场安装]
    C -->|NO_SKILL_NEEDED| I[直接执行任务]
    
    style D fill:#90EE90
    style E fill:#87CEEB
    style F fill:#FFD700
    style G fill:#DDA0DD
    style H fill:#FFA07A
    style I fill:#D3D3D3
```

### 4.3 代码目录结构

```
skillix-mcp/
├── src/
│   ├── index.ts                 # MCP Server 入口
│   ├── tools/                   # MCP 工具实现
│   │   ├── index.ts             # 工具统一导出（从子目录导出）
│   │   ├── types.ts             # 工具参数类型 + ToolResponse
│   │   ├── skills/              # sx-skill 工具
│   │   │   ├── index.ts         # 工具入口 + 子命令导出
│   │   │   ├── list.ts          # 列出技能
│   │   │   ├── read.ts          # 读取技能
│   │   │   ├── create.ts        # 创建技能
│   │   │   ├── update.ts        # 更新技能
│   │   │   └── delete.ts        # 删除技能
│   │   ├── configs/             # sx-config 工具
│   │   │   ├── index.ts         # 工具入口 + 子命令导出
│   │   │   ├── get.ts           # 获取配置
│   │   │   ├── set.ts           # 设置配置
│   │   │   ├── init.ts          # 初始化项目
│   │   │   └── sources.ts       # 管理技能源
│   │   └── helps/               # sx-help 工具
│   │       ├── index.ts         # 工具入口 + 帮助内容导出
│   │       ├── overview.ts      # 概述帮助
│   │       ├── skill.ts         # 技能工具帮助
│   │       └── config.ts        # 配置工具帮助
│   ├── services/                # 业务服务层
│   │   ├── index.ts             # 统一导出
│   │   ├── types.ts             # 服务层类型定义（领域类型）
│   │   ├── config/              # 配置管理服务
│   │   │   ├── index.ts         # 统一导出
│   │   │   ├── global.ts        # 全局配置
│   │   │   ├── project.ts       # 项目配置
│   │   │   ├── effective.ts     # 有效配置计算
│   │   │   └── source.ts        # 技能源管理
│   │   └── skill/               # 技能管理服务
│   │       ├── index.ts         # 统一导出
│   │       ├── list.ts          # 列出技能
│   │       ├── get.ts           # 获取技能
│   │       ├── read.ts          # 读取技能内容
│   │       ├── create.ts        # 创建技能
│   │       ├── update.ts        # 更新技能
│   │       ├── delete.ts        # 删除技能
│   │       ├── exists.ts        # 检查技能存在
│   │       ├── load.ts          # 加载技能
│   │       └── search.ts        # 搜索技能
│   ├── resources/               # MCP 资源实现（待实现）
│   └── utils/                   # 工具函数
│       ├── fs.ts                # 文件系统操作
│       ├── markdown.ts          # Markdown 解析
│       └── paths.ts             # 路径处理
├── tests/                       # 测试目录
│   ├── fixtures/                # 测试数据
│   ├── helpers/                 # 测试辅助函数
│   ├── services/                # 服务层测试
│   ├── tools/                   # 工具层测试
│   └── utils/                   # 工具函数测试
├── docs/                        # 设计文档
│   ├── 01-调研/                 # 调研文档
│   ├── 02-设计/                 # 设计文档
│   └── 03-实现/                 # 实现文档
├── refer/                       # 参考项目
├── package.json
├── tsconfig.json
├── vitest.config.ts             # 测试配置
└── README.md
```

> **类型文件说明**：
> - `src/services/types.ts` 存放**服务层类型**（领域类型），如 `SkillMetadata`, `Skill`, `GlobalConfig`, `SkillSource` 等
> - `src/tools/types.ts` 存放**工具层类型**（MCP 工具输入/输出），如 `SxSkillParams`, `ToolResponse` 等
> - 类型按使用层级划分，服务层类型集中在 `services/types.ts`，工具层类型集中在 `tools/types.ts`

---

## 五、核心功能设计

### 5.1 精简版工具设计（推荐）

> 以下为精简版工具设计，将 11 个工具合并为 5 个，适用于有工具数量限制的场景。

#### sx-skill（技能管理）

统一的技能管理工具，通过 `action` 参数区分操作。

```typescript
{
  name: "sx-skill",
  description: "技能管理：列出、读取、创建、更新、删除技能",
  inputSchema: {
    type: "object",
    properties: {
      action: {
        type: "string",
        enum: ["list", "read", "create", "update", "delete"],
        description: "操作类型"
      },
      name: {
        type: "string",
        description: "技能名称（read/create/update/delete 时需要）"
      },
      scope: {
        type: "string",
        enum: ["all", "global", "project"],
        description: "技能范围（list 时使用，默认 all）"
      },
      content: {
        type: "string",
        description: "技能内容（create/update 时需要）"
      },
      description: {
        type: "string",
        description: "技能描述（create 时需要）"
      }
    },
    required: ["action"]
  }
}
```

#### sx-market（市场操作）

统一的市场操作工具。

```typescript
{
  name: "sx-market",
  description: "技能市场：搜索、安装、卸载技能",
  inputSchema: {
    type: "object",
    properties: {
      action: {
        type: "string",
        enum: ["search", "install", "uninstall"],
        description: "操作类型"
      },
      query: {
        type: "string",
        description: "搜索关键词（search 时需要）"
      },
      name: {
        type: "string",
        description: "技能名称（install/uninstall 时需要）"
      },
      source: {
        type: "string",
        description: "技能源名称（install 时可选）"
      },
      scope: {
        type: "string",
        enum: ["global", "project"],
        description: "安装范围（install 时使用，默认 global）"
      }
    },
    required: ["action"]
  }
}
```

#### sx-config（配置管理）

统一的配置管理工具。

```typescript
{
  name: "sx-config",
  description: "配置管理：初始化项目、管理技能源",
  inputSchema: {
    type: "object",
    properties: {
      action: {
        type: "string",
        enum: ["init", "sources"],
        description: "操作类型"
      },
      subAction: {
        type: "string",
        enum: ["list", "add", "remove"],
        description: "子操作（sources 时需要）"
      },
      force: {
        type: "boolean",
        description: "强制覆盖（init 时可选）"
      },
      name: {
        type: "string",
        description: "源名称（sources add/remove 时需要）"
      },
      url: {
        type: "string",
        description: "GitHub 仓库 URL（sources add 时需要）"
      },
      scope: {
        type: "string",
        enum: ["global", "project"],
        description: "配置范围（默认 global）"
      }
    },
    required: ["action"]
  }
}
```

---

### 5.2 完整版工具设计

> 以下为完整版工具设计，共 11 个工具，适用于无工具数量限制的场景。

#### sx_init（初始化项目）

初始化项目配置，创建 `.skillix/` 目录结构。

```typescript
{
  name: "sx_init",
  description: "初始化项目 Skillix 配置，创建 .skillix/ 目录",
  inputSchema: {
    type: "object",
    properties: {
      force: {
        type: "boolean",
        description: "强制覆盖已存在的配置（默认 false）"
      }
    }
  }
}
```

**返回示例**：
```xml
<init_result>
  <status>success</status>
  <skillix_dir>.skillix/</skillix_dir>
  <config_file>.skillix/config.json</config_file>
  <skills_dir>.skillix/skills/</skills_dir>
  <logs_dir>.skillix/logs/</logs_dir>
</init_result>
```

---

### 5.3 技能管理工具（完整版）

#### sx_list（列出技能）

列出所有可用技能，区分全局和项目级。

```typescript
{
  name: "sx_list",
  description: "列出所有可用技能，区分全局和项目级",
  inputSchema: {
    type: "object",
    properties: {
      scope: {
        type: "string",
        enum: ["all", "global", "project"],
        description: "技能范围：all=全部, global=全局, project=项目级"
      },
      format: {
        type: "string",
        enum: ["json", "xml", "table"],
        description: "输出格式，默认 xml"
      }
    }
  }
}
```

**返回示例**：
```xml
<available_skills>
  <global_skills>
    <skill>
      <name>pdf</name>
      <description>PDF 处理工具包</description>
      <source>skillix-hub</source>
    </skill>
    <skill>
      <name>xlsx</name>
      <description>Excel 电子表格处理</description>
      <source>skillix-hub</source>
    </skill>
  </global_skills>
  <project_skills>
    <skill>
      <name>custom-api</name>
      <description>项目自定义 API 处理</description>
      <source>local</source>
    </skill>
  </project_skills>
</available_skills>
```

#### sx_read（读取技能）

```typescript
{
  name: "sx_read",
  description: "读取指定技能的 SKILL.md 内容",
  inputSchema: {
    type: "object",
    properties: {
      name: {
        type: "string",
        description: "技能名称"
      },
      scope: {
        type: "string",
        enum: ["auto", "global", "project"],
        description: "技能范围，auto=自动查找（默认）"
      }
    },
    required: ["name"]
  }
}
```

#### sx_create（创建技能）

```typescript
{
  name: "sx_create",
  description: "创建新技能",
  inputSchema: {
    type: "object",
    properties: {
      name: {
        type: "string",
        description: "技能名称（英文，小写，连字符分隔）"
      },
      description: {
        type: "string",
        description: "技能描述"
      },
      content: {
        type: "string",
        description: "技能正文内容（Markdown 格式）"
      },
      scope: {
        type: "string",
        enum: ["global", "project"],
        description: "创建范围：global=全局, project=项目级（默认）"
      }
    },
    required: ["name", "description", "content"]
  }
}
```

### 5.4 技能市场工具（完整版）

#### sx_install（安装技能）

从技能市场安装技能到本地。

```typescript
{
  name: "sx_install",
  description: "从技能市场安装技能",
  inputSchema: {
    type: "object",
    properties: {
      name: {
        type: "string",
        description: "技能名称"
      },
      source: {
        type: "string",
        description: "技能源（默认使用官方源）"
      },
      scope: {
        type: "string",
        enum: ["global", "project"],
        description: "安装范围：global=全局（默认）, project=项目级"
      }
    },
    required: ["name"]
  }
}
```

#### sx_search（搜索技能）

搜索技能市场中的可用技能。

```typescript
{
  name: "sx_search",
  description: "搜索技能市场中的可用技能",
  inputSchema: {
    type: "object",
    properties: {
      query: {
        type: "string",
        description: "搜索关键词"
      },
      tags: {
        type: "array",
        items: { type: "string" },
        description: "按标签筛选"
      }
    },
    required: ["query"]
  }
}
```

#### sx_sources（管理技能源）

管理技能源列表（配置远程仓库地址）。

> **与其他工具的区别**：
> - `sx_sources`：管理**技能源配置**（GitHub 仓库地址），类似于 npm registry
> - `sx_list`：列出**已安装的技能**（本地技能）
> - `sx_install`：从技能源**下载并安装**具体技能
> - `sx_uninstall`：**卸载**已安装的技能

```typescript
{
  name: "sx_sources",
  description: "管理技能源（远程仓库地址）",
  inputSchema: {
    type: "object",
    properties: {
      action: {
        type: "string",
        enum: ["list", "add", "remove"],
        description: "操作：list=列出配置的源, add=添加新源, remove=移除源"
      },
      url: {
        type: "string",
        description: "GitHub 仓库 URL（add/remove 时需要）"
      },
      name: {
        type: "string",
        description: "源名称（add 时需要）"
      },
      scope: {
        type: "string",
        enum: ["global", "project"],
        description: "配置范围：global=全局配置, project=项目配置（默认 global）"
      }
    },
    required: ["action"]
  }
}
```

**工具关系图**：

```mermaid
flowchart LR
    subgraph Config["配置层"]
        Sources["sx_sources<br/>管理技能源地址"]
    end
    
    subgraph Market["市场层"]
        Search["sx_search<br/>搜索远程技能"]
        Install["sx_install<br/>安装技能"]
    end
    
    subgraph Local["本地层"]
        List["sx_list<br/>列出已安装技能"]
        Uninstall["sx_uninstall<br/>卸载技能"]
    end
    
    Sources --> |提供源地址| Search
    Search --> |找到技能| Install
    Install --> |安装到本地| List
    List --> |选择技能| Uninstall
    
    style Sources fill:#FFD700
    style Search fill:#87CEEB
    style Install fill:#90EE90
    style List fill:#DDA0DD
```

---

## 六、本地存储设计

### 6.1 全局目录结构 (~/.skillix/)

MCP Server 启动时会自动创建全局配置目录：

```
~/.skillix/
├── config.json              # 全局配置文件
├── skills/                  # 全局技能目录
│   ├── pdf/
│   │   ├── SKILL.md
│   │   └── logs/            # 技能级日志
│   │       ├── execution.log
│   │       └── evolution.log
│   ├── xlsx/
│   │   ├── SKILL.md
│   │   └── logs/
│   └── ...
├── logs/                    # 系统日志目录
│   ├── skillix.log          # 主日志文件
│   ├── skillix.log.1        # 轮转日志
│   └── ...
├── cache/                   # 缓存目录
│   ├── sources/             # 技能源索引缓存
│   │   ├── official.json    # 官方源缓存
│   │   └── team-skills.json # 其他源缓存
│   └── downloads/           # 下载临时目录
└── data/                    # 数据目录
    ├── feedback.json        # 反馈数据
    └── statistics.json      # 使用统计
```

**日志分层说明**：
- `~/.skillix/logs/`：系统级日志，记录 MCP Server 运行状态
- `~/.skillix/skills/{skill-name}/logs/`：技能级日志，记录单个技能的执行和进化历史

### 6.2 全局配置文件 (config.json)

```json
{
  "version": "1.0.0",
  "sources": [
    {
      "name": "official",
      "url": "https://github.com/user/skillix-hub",
      "branch": "main",
      "default": true
    },
    {
      "name": "team-skills",
      "url": "https://github.com/team/custom-skills",
      "branch": "main",
      "default": false
    }
  ],
  "defaultScope": "global",
  "format": "xml",
  "autoSuggest": true,
  "suggestThreshold": {
    "repeatCount": 3,
    "stepCount": 5
  },
  "logging": {
    "level": "info",
    "maxFiles": 5,
    "maxSize": "10MB"
  },
  "cache": {
    "enabled": true,
    "ttl": 3600
  }
}
```

**配置字段说明**：

| 字段 | 类型 | 说明 |
|------|------|------|
| `version` | string | 配置文件版本 |
| `sources` | array | 技能源列表 |
| `sources[].name` | string | 源名称（唯一标识） |
| `sources[].url` | string | GitHub 仓库 URL |
| `sources[].branch` | string | 分支名称（默认 main） |
| `sources[].default` | boolean | 是否为默认源 |
| `defaultScope` | string | 默认技能范围（global/project） |
| `format` | string | 默认输出格式（xml/json） |
| `autoSuggest` | boolean | 是否启用自动建议 |
| `suggestThreshold` | object | 建议触发阈值 |
| `logging` | object | 日志配置 |
| `cache` | object | 缓存配置 |

### 6.3 项目目录结构 (.skillix/)

项目配置和技能统一存放在 `.skillix/` 目录下，采用**本地优先策略**，项目配置独立于全局配置。

```
project/
└── .skillix/                    # 项目级 Skillix 目录
    ├── config.json              # 项目配置文件
    ├── skills/                  # 项目级技能目录
    │   ├── custom-api/
    │   │   ├── SKILL.md
    │   │   └── logs/
    │   └── ...
    └── logs/                    # 项目级日志目录
        └── skillix.log
```

**项目配置文件 (.skillix/config.json)**：

```json
{
  "sources": [
    {
      "name": "project-specific",
      "url": "https://github.com/project/skills",
      "branch": "main"
    }
  ],
  "format": "xml",
  "autoSuggest": true,
  "feedback": {
    "enabled": true,
    "autoRecord": false
  }
}
```

**项目初始化流程**：

```mermaid
flowchart TD
    A[sx_init 初始化项目] --> B[创建 .skillix/ 目录]
    B --> C[创建 config.json]
    C --> D[创建 skills/ 目录]
    D --> E[创建 logs/ 目录]
    E --> F[初始化完成]
    
    style B fill:#90EE90
    style F fill:#87CEEB
```

### 6.4 本地优先策略

Skillix 采用**本地优先策略**，简化配置管理：

```mermaid
flowchart TD
    subgraph Search["技能查找顺序"]
        S1["1. 项目技能目录<br/>./.skillix/skills/"]
        S2["2. 全局技能目录<br/>~/.skillix/skills/"]
        S3["3. 远程技能市场"]
    end
    
    S1 --> |未找到| S2
    S2 --> |未找到| S3
    
    style S1 fill:#FFD700
    style S2 fill:#87CEEB
    style S3 fill:#D3D3D3
```

**核心原则**：

| 原则 | 说明 |
|------|------|
| **项目优先** | 项目级技能优先于全局技能 |
| **配置独立** | 项目配置和全局配置相互独立，不进行合并 |
| **就近原则** | 优先使用最近的配置和技能 |
| **显式声明** | 项目需要的技能源在项目配置中显式声明 |

**技能查找规则**：

1. **同名技能**：项目级技能覆盖全局技能
2. **技能源**：项目配置的 sources 仅用于该项目
3. **全局技能**：始终可用，作为兜底选项

**配置字段说明**：

| 字段 | 类型 | 说明 |
|------|------|------|
| `sources` | array | 项目级技能源列表 |
| `format` | string | 输出格式 |
| `autoSuggest` | boolean | 是否启用自动建议 |
| `feedback` | object | 反馈配置 |

### 6.5 配置优先级

```mermaid
flowchart TD
    A[项目配置<br/>.skillix/config.json] -->|覆盖| B[全局配置<br/>~/.skillix/config.json]
    B -->|覆盖| C[默认配置<br/>内置默认值]
    
    style A fill:#FFD700
    style B fill:#87CEEB
    style C fill:#D3D3D3
```

### 6.6 日志设计

**日志级别**：

| 级别 | 说明 |
|------|------|
| `error` | 错误信息 |
| `warn` | 警告信息 |
| `info` | 一般信息（默认） |
| `debug` | 调试信息 |

**日志格式**：

```
[2026-01-11T10:30:00.000Z] [INFO] [sx_install] Installing skill: pdf from official
[2026-01-11T10:30:01.234Z] [INFO] [sx_install] Skill installed successfully: ~/.skillix/skills/pdf/
[2026-01-11T10:30:05.000Z] [ERROR] [sx_search] Failed to fetch source: network error
```

**日志轮转**：
- 单个日志文件最大 10MB
- 最多保留 5 个历史日志文件
- 自动清理过期日志

---

## 七、技能格式规范

### 7.1 SKILL.md 格式

```markdown
---
name: skill-name
description: 清晰描述技能用途和触发场景
version: 1.0.0
author: your-name
tags: [tag1, tag2]
---

# 技能标题

## 使用说明

[详细指令]

## 依赖

[依赖列表]

## 示例

[使用示例]
```

### 7.2 目录结构

```
skill-name/
├── SKILL.md           # 必需：技能定义文件
├── scripts/           # 可选：辅助脚本
├── references/        # 可选：参考文档
├── assets/            # 可选：资源文件
└── logs/              # 可选：技能执行日志
    ├── execution.log  # 执行日志
    └── evolution.log  # 进化历史日志
```

**logs 目录说明**：
- `execution.log`：记录技能被调用的历史，包括调用时间、参数、结果等
- `evolution.log`：记录技能的进化历史，包括版本变更、改进原因等
- 日志文件由 MCP Server 自动管理，支持轮转和清理

---

## 八、使用方式

### 8.1 全局 MCP 配置（一次性）

```json
// ~/.cursor/mcp.json
{
  "mcpServers": {
    "skillix": {
      "command": "npx",
      "args": ["skillix-mcp"]
    }
  }
}
```

### 8.2 初始化全局配置

首次使用时，MCP Server 会自动创建全局配置目录：

```
~/.skillix/
├── config.json              # 全局配置
├── skills/                  # 全局技能目录
├── logs/                    # 日志目录
├── cache/                   # 缓存目录
│   ├── sources/             # 技能源索引缓存
│   └── downloads/           # 下载临时目录
└── data/                    # 数据目录
```

**初始化流程**：

```mermaid
flowchart TD
    A[MCP Server 启动] --> B{~/.skillix/ 存在?}
    B -->|否| C[创建目录结构]
    C --> D[生成默认 config.json]
    D --> E[初始化完成]
    B -->|是| F{config.json 存在?}
    F -->|否| D
    F -->|是| G[加载配置]
    G --> E
```

### 8.3 使用流程示例

```mermaid
sequenceDiagram
    participant U as 用户
    participant AI as AI
    participant MCP as Skillix MCP
    participant Market as 技能市场
    
    U->>AI: 帮我处理这个 PDF 文件
    AI->>MCP: sx_list scope="all"
    MCP-->>AI: 没有找到 pdf 技能
    AI->>MCP: sx_search query="pdf"
    MCP->>Market: 搜索技能
    Market-->>MCP: 找到 pdf 技能
    MCP-->>AI: 返回搜索结果
    AI->>U: 找到了 pdf 技能，是否要安装？
    U->>AI: 是的，安装到全局
    AI->>MCP: sx_install name="pdf" scope="global"
    MCP->>Market: 下载技能
    Market-->>MCP: 返回技能内容
    MCP-->>AI: 安装成功
    AI->>MCP: sx_read name="pdf"
    MCP-->>AI: 返回技能内容
    AI->>U: 根据技能指令处理 PDF...
```

### 8.4 管理技能源流程

```mermaid
sequenceDiagram
    participant U as 用户
    participant AI as AI
    participant MCP as Skillix MCP
    
    U->>AI: 添加我们团队的技能仓库
    AI->>U: 好的，请提供仓库地址
    U->>AI: https://github.com/our-team/skills
    AI->>MCP: sx_sources action="add"<br/>name="team"<br/>url="https://github.com/our-team/skills"
    MCP-->>AI: 技能源已添加
    AI->>U: 技能源已添加！<br/>现在可以从这个源安装技能了
```

---

*本文档为 Skillix 项目设计文档*
*采用双仓库架构：skillix-mcp (MCP Server) + skillix-hub (技能中心)*
*支持全局技能和项目级技能，可配置多个技能源*
