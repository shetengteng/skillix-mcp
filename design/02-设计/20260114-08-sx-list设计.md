# sx-skill list 技能列表设计

> 日期: 2026-01-14
> 关联: 20260111-01-项目设计.md
> 状态: 设计中

---

## 一、概述

### 1.1 功能定位

`sx-skill list` 是 Skillix 的技能发现工具，用于列出可用的技能。

**核心职责**：
- 扫描全局和项目技能目录
- 读取技能元数据
- 返回格式化的技能列表
- 支持过滤和搜索

### 1.2 设计目标

1. **快速响应** - 高效扫描和返回
2. **信息完整** - 包含必要的元数据
3. **清晰分类** - 区分全局和项目技能
4. **易于筛选** - 支持 scope 过滤

---

## 二、列表流程

### 2.1 主流程

```mermaid
flowchart TD
    A[开始列表] --> B[解析参数]
    B --> C{scope 值?}
    
    C -->|global| D[扫描全局目录]
    C -->|project| E[扫描项目目录]
    C -->|all/未指定| F[扫描所有目录]
    
    D --> G[读取技能元数据]
    E --> H[读取技能元数据]
    F --> I[扫描全局目录]
    I --> J[扫描项目目录]
    J --> K[读取技能元数据]
    
    G --> L[构建技能列表]
    H --> L
    K --> L
    
    L --> M[格式化输出]
    M --> N[返回结果]
    
    style N fill:#90EE90
```

### 2.2 目录扫描流程

```mermaid
flowchart TD
    A[开始扫描] --> B[确定目录路径]
    
    B --> C{目录存在?}
    C -->|否| D[返回空列表]
    C -->|是| E[遍历子目录]
    
    E --> F{是技能目录?}
    F -->|否| G[跳过]
    F -->|是| H[检查 SKILL.md]
    
    H --> I{文件存在?}
    I -->|否| G
    I -->|是| J[解析元数据]
    
    J --> K[添加到列表]
    G --> L{还有子目录?}
    K --> L
    
    L -->|是| E
    L -->|否| M[返回技能列表]
    
    style M fill:#90EE90
```

### 2.3 元数据读取流程

```mermaid
flowchart TD
    A[读取 SKILL.md] --> B[解析 YAML Frontmatter]
    B --> C{解析成功?}
    
    C -->|否| D[使用默认值]
    C -->|是| E[提取元数据]
    
    D --> F[构建 ListedSkill]
    E --> F
    
    F --> G[设置 name]
    G --> H[设置 description]
    H --> I[设置 scope]
    I --> J[设置 path]
    J --> K[设置可选字段]
    K --> L[返回 ListedSkill]
    
    style L fill:#90EE90
```

---

## 三、输入输出设计

### 3.1 输入参数

```mermaid
classDiagram
    class ListParams {
        +string action = "list"
        +SkillScope scope
        +string projectRoot
    }
    
    class SkillScope {
        <<enumeration>>
        global
        project
        all
    }
    
    ListParams --> SkillScope
```

| 参数 | 类型 | 必需 | 说明 |
|------|------|------|------|
| action | string | ✅ | 固定为 "list" |
| scope | string | ❌ | 范围，默认 "all" |
| projectRoot | string | ❌ | 项目根目录（scope=project/all 时使用） |

### 3.2 输出响应

```mermaid
classDiagram
    class ListResponse {
        +boolean success
        +string message
        +ListData data
    }
    
    class ListData {
        +int total
        +ListedSkill[] global
        +ListedSkill[] project
    }
    
    class ListedSkill {
        +string name
        +string description
        +string scope
        +string path
        +string version
        +string[] tags
    }
    
    ListResponse --> ListData
    ListData --> ListedSkill
```

---

## 四、技能发现机制

### 4.1 扫描目录

```mermaid
flowchart LR
    subgraph 全局技能
        A["~/.skillix/skills/"]
        A --> A1["skill-1/SKILL.md"]
        A --> A2["skill-2/SKILL.md"]
    end
    
    subgraph 项目技能
        B[".skillix/skills/"]
        B --> B1["local-1/SKILL.md"]
        B --> B2["local-2/SKILL.md"]
    end
```

### 4.2 技能判定规则

```mermaid
flowchart TD
    A[目录] --> B{包含 SKILL.md?}
    B -->|否| C[不是技能]
    B -->|是| D{SKILL.md 可读?}
    
    D -->|否| E[跳过，记录警告]
    D -->|是| F{有效 Frontmatter?}
    
    F -->|否| G[使用目录名作为技能名]
    F -->|是| H[读取元数据]
    
    G --> I[添加到列表]
    H --> I
    
    style I fill:#90EE90
    style C fill:#D3D3D3
    style E fill:#FFD700
```

### 4.3 优先级规则

```mermaid
flowchart TD
    A[同名技能] --> B{项目技能存在?}
    B -->|是| C[使用项目技能]
    B -->|否| D[使用全局技能]
    
    C --> E[标记 scope=project]
    D --> F[标记 scope=global]
    
    style C fill:#87CEEB
    style D fill:#98FB98
```

**覆盖规则**：项目技能优先级高于全局技能

---

## 五、列表展示

### 5.1 返回数据结构

```mermaid
classDiagram
    class ListSkillsResponse {
        +boolean success
        +string message
        +ResponseData data
    }
    
    class ResponseData {
        +int total
        +ListedSkill[] global
        +ListedSkill[] project
    }
    
    class ListedSkill {
        +string name
        +string description
        +string scope
        +string path
        +string version
        +string[] tags
    }
    
    ListSkillsResponse --> ResponseData
    ResponseData --> ListedSkill
```

### 5.2 展示示例

```
技能列表:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

全局技能 (2):
──────────────────────────────────────────────────
  pdf-converter
    描述: PDF 文件格式转换工具
    版本: 1.0.0
    标签: [pdf, converter]
    路径: ~/.skillix/skills/pdf-converter/
    
  excel-handler
    描述: Excel 文件处理工具
    版本: 1.0.0
    标签: [excel, data]
    路径: ~/.skillix/skills/excel-handler/

项目技能 (1):
──────────────────────────────────────────────────
  custom-api
    描述: 项目专用 API 技能
    版本: 1.0.0
    标签: [api, custom]
    路径: .skillix/skills/custom-api/

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总计: 3 个技能
```

---

## 六、错误处理

### 6.1 错误场景

```mermaid
flowchart TD
    A[可能的错误] --> B[目录不存在]
    A --> C[权限不足]
    A --> D[SKILL.md 解析失败]
    A --> E[projectRoot 无效]
    
    B --> B1[返回空列表]
    C --> C1[记录警告，跳过]
    D --> D1[记录警告，使用默认值]
    E --> E1[返回错误]
    
    style B1 fill:#98FB98
    style C1 fill:#FFD700
    style D1 fill:#FFD700
    style E1 fill:#FFA07A
```

### 6.2 错误响应

| 场景 | 处理方式 | 响应 |
|------|----------|------|
| 目录不存在 | 静默处理 | 返回空列表 |
| 权限不足 | 记录警告 | 跳过该技能 |
| 解析失败 | 记录警告 | 使用默认值 |
| projectRoot 无效 | 返回错误 | success: false |

---

## 七、性能优化

### 7.1 优化策略

```mermaid
flowchart TD
    A[性能优化] --> B[缓存机制]
    A --> C[并行扫描]
    A --> D[延迟加载]
    
    B --> B1[缓存技能列表]
    B --> B2[缓存元数据]
    
    C --> C1[并行扫描全局和项目]
    
    D --> D1[仅读取必要字段]
    D --> D2[按需加载完整内容]
```

### 7.2 缓存策略

```mermaid
flowchart TD
    A[请求列表] --> B{缓存存在?}
    B -->|是| C{缓存有效?}
    B -->|否| D[扫描目录]
    
    C -->|是| E[返回缓存]
    C -->|否| D
    
    D --> F[更新缓存]
    F --> G[返回结果]
    
    style E fill:#90EE90
    style G fill:#90EE90
```

---

## 八、使用场景

### 8.1 AI 技能发现

```mermaid
sequenceDiagram
    participant U as 用户
    participant AI as AI
    participant T as sx-skill
    
    U->>AI: 帮我处理 PDF
    AI->>T: list(scope: "all")
    T-->>AI: {global: [...], project: [...]}
    AI->>AI: 匹配技能
    AI->>U: 找到 pdf-converter 技能
```

### 8.2 技能管理

```mermaid
sequenceDiagram
    participant U as 用户
    participant T as sx-skill
    
    U->>T: list(scope: "global")
    T-->>U: 全局技能列表
    
    U->>T: list(scope: "project")
    T-->>U: 项目技能列表
```

---

## 九、与其他工具的关系

### 9.1 工具关系图

```mermaid
flowchart TD
    subgraph sx-skill
        A[list]
        B[create]
        C[read]
        D[update]
        E[delete]
    end
    
    subgraph sx-dispatch
        F[analyze]
    end
    
    A -->|提供技能列表| F
    B -->|创建后更新| A
    E -->|删除后更新| A
    A -->|选择技能| C
    
    style A fill:#87CEEB
```

### 9.2 典型工作流

```mermaid
flowchart LR
    A[sx-skill list] --> B[获取可用技能]
    B --> C[sx-dispatch 分析]
    C --> D{匹配结果}
    D -->|USE_EXISTING| E[sx-skill read]
    D -->|CREATE_NEW| F[sx-skill create]
    
    style A fill:#87CEEB
```

---

*本文档为 sx-skill list 设计文档*
*最后更新: 2026-01-14*
