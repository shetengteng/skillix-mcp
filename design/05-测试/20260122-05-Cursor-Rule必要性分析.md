# Cursor Rule 必要性分析

> 文档日期：2026-01-22
> 问题：MCP 已经把 Tool 的设定给 Cursor，是否还需要 Cursor Rule？

## 一、问题背景

### 1.1 当前设计

Skillix 在 `sx-config init` 时会自动安装一个 Cursor Rule 文件到 `.cursor/rules/skillix.mdc`。

### 1.2 疑问

MCP 协议已经将工具描述（Tool Description）传递给 Cursor/AI，那么：
- Cursor Rule 是否是冗余的？
- 是否有必要额外安装 Rule 文件？

---

## 二、MCP Tool Description vs Cursor Rule

### 2.1 MCP Tool Description

**位置**：定义在 `src/tools/*/index.ts` 中

**内容示例**：

```typescript
export const sxSkillDefinition = {
  name: 'sx-skill',
  description: `本地技能管理工具，支持 list, read, create, update, delete 操作。

【AI First 创建模式】
创建技能时，若用户需求模糊，请先通过对话引导收集信息，再调用 create。
详细引导流程请调用: sx-help topic=skill

【技能命名】hyphen-case 格式，如 pdf-converter`,
  inputSchema: { ... }
};
```

**特点**：
- ✅ 自动传递给 AI
- ✅ 描述工具的功能和参数
- ❌ 无法定义工作流程
- ❌ 无法设置"每次会话"的行为
- ❌ 分散在各个工具中

### 2.2 Cursor Rule

**位置**：`.cursor/rules/skillix.mdc`

**内容示例**：

```markdown
---
description: Skillix 智能分流规则
alwaysApply: true
---

# Skillix 使用规范

## 会话启动流程

**重要**：每次新会话开始时，如果用户提出了一个任务需求，应该：

1. 首先调用 sx-dispatch 分析任务
2. 根据返回结果决定下一步操作
3. 执行任务
4. 反馈与进化（可选）
```

**特点**：
- ✅ 可以定义工作流程
- ✅ 可以设置"每次会话"的行为
- ✅ 集中定义使用规范
- ✅ `alwaysApply: true` 确保始终生效
- ❌ 需要额外安装

---

## 三、对比分析

| 维度 | MCP Tool Description | Cursor Rule |
|------|---------------------|-------------|
| **传递方式** | MCP 协议自动传递 | 需要文件存在于项目中 |
| **作用范围** | 单个工具 | 整个项目/会话 |
| **内容类型** | 工具功能描述 | 工作流程、使用规范 |
| **触发时机** | AI 调用工具时参考 | 每次会话开始时应用 |
| **可定义内容** | 工具参数、用法 | 流程、规范、最佳实践 |
| **维护位置** | 代码中 | 项目配置中 |

---

## 四、核心问题：为什么需要 Cursor Rule？

### 4.1 Tool Description 无法解决的问题

**问题 1：AI 不知道何时主动调用 sx-dispatch**

Tool Description 只告诉 AI "sx-dispatch 是什么"，但不会告诉 AI "每次会话开始时应该先调用 sx-dispatch"。

```
没有 Rule 的情况：
用户: "帮我处理 PDF 文件"
AI: [直接开始处理，不知道要先调用 sx-dispatch]

有 Rule 的情况：
用户: "帮我处理 PDF 文件"
AI: [根据 Rule，先调用 sx-dispatch 分析任务]
    [发现有 pdf-converter 技能]
    [读取技能内容]
    [按照技能指引执行]
```

**问题 2：工作流程无法在 Tool Description 中定义**

Tool Description 是分散的，每个工具独立描述自己。无法定义跨工具的工作流程：

```
sx-dispatch → sx-skill read → 执行任务 → sx-skill update
```

这种流程需要在 Cursor Rule 中统一定义。

**问题 3：`alwaysApply` 机制**

Cursor Rule 的 `alwaysApply: true` 确保规则在每次会话中都生效，这是 Tool Description 无法实现的。

---

## 五、结论与建议

### 5.1 结论

**Cursor Rule 是必要的**，原因如下：

| 原因 | 说明 |
|------|------|
| **定义工作流程** | Tool Description 只能描述单个工具，无法定义跨工具流程 |
| **主动触发** | Rule 可以指导 AI 在会话开始时主动调用 sx-dispatch |
| **统一规范** | 集中定义使用规范，避免分散在各个工具描述中 |
| **alwaysApply** | 确保规则始终生效 |

### 5.2 两者的关系

```
┌─────────────────────────────────────────────────────────┐
│                    Cursor Rule                          │
│  - 定义工作流程                                          │
│  - 指导何时调用什么工具                                   │
│  - 统一使用规范                                          │
└─────────────────────────────────────────────────────────┘
                          ↓ 指导
┌─────────────────────────────────────────────────────────┐
│               MCP Tool Description                       │
│  - 描述工具功能                                          │
│  - 定义参数格式                                          │
│  - 提供使用示例                                          │
└─────────────────────────────────────────────────────────┘
```

**Cursor Rule 是"指挥官"**，告诉 AI 整体策略和流程。
**Tool Description 是"说明书"**，告诉 AI 每个工具怎么用。

### 5.3 建议

1. **保留 Cursor Rule 自动安装**：在 `sx-config init` 时安装
2. **精简 Tool Description**：只保留工具功能描述，流程相关内容移到 Rule
3. **Rule 内容优化**：确保 Rule 清晰定义工作流程
4. **可选安装**：提供 `--no-rule` 选项，让用户选择是否安装

---

## 六、优化建议

### 6.1 当前 Rule 内容评估

当前 `skillix.mdc` 内容较长（约 100 行），可以精简为：

```markdown
---
description: Skillix 智能分流规则
alwaysApply: true
---

# Skillix 使用规范

## 核心流程

每次用户提出任务需求时：

1. **分析任务**：调用 `sx-dispatch task="任务描述"` 
2. **执行操作**：根据返回的 action 执行相应操作
3. **反馈进化**：任务完成后可更新技能

## 操作类型

| action | 下一步 |
|--------|--------|
| USE_EXISTING | `sx-skill action=read name="技能名"` |
| CREATE_NEW | 引导创建，`sx-skill action=create` |
| INSTALL | `sx-market action=install name="技能名"` |
| NO_SKILL_NEEDED | 直接执行任务 |

## 获取帮助

调用 `sx-help` 获取详细使用说明。
```

### 6.2 Tool Description 优化

将流程相关内容从 Tool Description 移到 Rule，保持 Description 简洁：

```typescript
// 优化前
description: `本地技能管理工具...
【AI First 创建模式】
创建技能时，若用户需求模糊，请先通过对话引导收集信息...
详细引导流程请调用: sx-help topic=skill
...`

// 优化后
description: `本地技能管理工具，支持 list, read, create, update, delete 操作。
创建技能时建议先调用 sx-help topic=skill 获取引导流程。`
```

---

## 七、总结

| 问题 | 答案 |
|------|------|
| Cursor Rule 是否必要？ | **是**，用于定义工作流程和使用规范 |
| 与 Tool Description 冲突吗？ | **不冲突**，两者互补 |
| 需要优化吗？ | **可以精简**，避免内容过长 |

**最终建议**：保留 Cursor Rule 自动安装，但精简内容，让 Rule 专注于流程定义，Tool Description 专注于功能描述。
