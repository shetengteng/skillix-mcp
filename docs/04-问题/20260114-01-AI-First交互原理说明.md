# AI First 交互原理说明

> 日期: 2026-01-14
> 背景: 解释 Skillix 中 AI First 创建模式的工作原理

---

## 一、问题背景

在设计文档中，我们看到这样的对话交互示例：

```
用户: 我想创建一个处理 Excel 文件的技能

AI: 好的，我来帮你创建 Excel 处理技能。请问你需要哪些功能？
    1. 读取和写入数据
    2. 格式转换（xlsx/csv/json）
    ...

用户: 主要是 1 和 2

AI: [调用 sx-skill action=create]
    ✅ 技能创建成功！
```

**问题**：这个对话交互是在 `create.ts` 中实现的吗？

**答案**：**不是！**

---

## 二、核心概念

### 2.1 两层架构

```
┌─────────────────────────────────────────────────────────┐
│                    AI 代理层 (Cursor)                    │
│                                                         │
│  • 理解用户意图                                          │
│  • 进行对话交互                                          │
│  • 收集需求信息                                          │
│  • 生成工具参数                                          │
│  • 调用 MCP 工具                                         │
└─────────────────────────────────────────────────────────┘
                          ↓ 调用
┌─────────────────────────────────────────────────────────┐
│                  MCP 工具层 (create.ts)                  │
│                                                         │
│  • 验证参数                                              │
│  • 创建文件和目录                                        │
│  • 返回结果                                              │
└─────────────────────────────────────────────────────────┘
```

### 2.2 职责划分

| 层级 | 职责 | 实现位置 |
|-----|------|---------|
| **AI 代理层** | 对话、理解、引导、决策 | Cursor / Claude |
| **MCP 工具层** | 执行、验证、存储 | `create.ts` |

---

## 三、工作原理

### 3.1 AI 代理如何知道要进行对话引导？

通过 **工具描述 (Tool Description)** 和 **帮助系统 (sx-help)**！

#### 工具描述

当 AI 代理加载 MCP 工具时，会读取工具的 `description` 字段：

```typescript
// src/tools/skills/index.ts
export const sxSkillDefinition = {
  name: 'sx-skill',
  description: `本地技能管理工具...

【AI First 创建模式】
创建技能时，若用户需求模糊，请先通过对话引导收集信息，再调用 create。
详细引导流程请调用: sx-help topic=skill
...`,
  // ...
};
```

AI 代理看到这个描述后，就知道：
1. 这是一个技能管理工具
2. 创建时需要先对话引导
3. 可以调用 `sx-help` 获取详细流程

#### 帮助系统

AI 代理可以调用 `sx-help topic=skill` 获取详细的引导流程：

```markdown
## AI First 创建模式 ⭐

### 引导流程

用户: "我想创建一个处理 PDF 的技能"

AI 引导问题（按顺序询问）:
1. "这个技能要解决什么问题？" → 明确核心功能
2. "什么情况下会触发这个技能？" → 定义触发场景
3. "需要执行哪些具体操作？" → 确定工作流程
4. "有什么特殊要求或限制？" → 识别约束条件
...
```

### 3.2 完整流程

```
┌──────────────────────────────────────────────────────────────┐
│ 1. AI 代理启动，加载 MCP 工具                                  │
│    ↓                                                         │
│ 2. 读取 sxSkillDefinition.description                        │
│    → 了解工具功能和 AI First 模式                              │
│    ↓                                                         │
│ 3. 用户说: "我想创建一个处理 PDF 的技能"                        │
│    ↓                                                         │
│ 4. AI 判断: 用户需求模糊，需要引导                              │
│    ↓                                                         │
│ 5. AI 调用 sx-help topic=skill 获取引导流程                    │
│    ↓                                                         │
│ 6. AI 按流程提问:                                              │
│    - "这个技能要解决什么问题？"                                 │
│    - "什么情况下会触发？"                                       │
│    - ...                                                      │
│    ↓                                                         │
│ 7. 收集完信息后，AI 生成参数:                                   │
│    name: "pdf-to-markdown"                                    │
│    metadata: { description: "...", tags: [...] }              │
│    body: "# PDF 转 Markdown\n..."                             │
│    ↓                                                         │
│ 8. AI 调用 sx-skill action=create name=... metadata=... body=.│
│    ↓                                                         │
│ 9. create.ts 验证参数、创建文件、返回结果                        │
│    ↓                                                         │
│ 10. AI 向用户展示: "✅ 技能创建成功！"                          │
└──────────────────────────────────────────────────────────────┘
```

---

## 四、为什么这样设计？

### 4.1 关注点分离

| 关注点 | 处理者 |
|-------|-------|
| 理解自然语言 | AI 代理 |
| 对话交互 | AI 代理 |
| 参数验证 | MCP 工具 |
| 文件操作 | MCP 工具 |

### 4.2 灵活性

- **AI 代理可以升级**：Claude 3 → Claude 4，对话能力自动提升
- **工具逻辑稳定**：`create.ts` 只做验证和创建，不受 AI 变化影响

### 4.3 可测试性

- **工具层**：可以用单元测试验证参数验证、文件创建
- **AI 层**：通过提示词工程优化对话质量

---

## 五、代码中的体现

### 5.1 工具描述（简洁提示）

```typescript
// src/tools/skills/index.ts
description: `本地技能管理工具...

【AI First 创建模式】
创建技能时，若用户需求模糊，请先通过对话引导收集信息，再调用 create。
详细引导流程请调用: sx-help topic=skill`
```

**作用**：AI 代理首先看到，快速了解工具用法

### 5.2 帮助系统（详细参考）

```typescript
// src/tools/helps/skill.ts
export const SKILL_HELP = `
## AI First 创建模式 ⭐

### 引导流程
...

### 对话示例
...

### 上下文充分性判断
...
`;
```

**作用**：AI 代理需要详细指导时调用

### 5.3 两者关系

```
工具描述 (index.ts)          帮助系统 (skill.ts)
┌─────────────────┐         ┌─────────────────────┐
│ 简洁提示        │ ──引导──→ │ 详细参考            │
│ "请先对话引导"   │         │ 完整流程、示例、标准  │
└─────────────────┘         └─────────────────────┘
```

**不是冗余**，而是**分层设计**：
- 工具描述：快速提示，告诉 AI "要做什么"
- 帮助系统：详细参考，告诉 AI "怎么做"

---

## 六、类比理解

想象一个餐厅：

| 角色 | 对应 | 职责 |
|-----|------|------|
| 服务员 | AI 代理 | 与顾客交流，了解需求，推荐菜品 |
| 厨师 | MCP 工具 | 按照订单做菜，不直接与顾客交流 |
| 菜单 | 工具描述 | 告诉服务员有什么菜 |
| 培训手册 | 帮助系统 | 教服务员如何推荐菜品 |

服务员（AI 代理）看菜单（工具描述）知道有什么菜，看培训手册（帮助系统）学习如何推荐。最后把订单交给厨师（MCP 工具）做菜。

---

## 七、总结

1. **对话交互在 AI 代理层**，不在 `create.ts` 中
2. **AI 代理通过工具描述和帮助系统**了解如何引导用户
3. **工具描述是快速提示**，帮助系统是详细参考，**不是冗余**
4. **这种设计实现了关注点分离**，让系统更灵活、可维护

---

*本文档解释了 Skillix 中 AI First 交互模式的工作原理*
*最后更新: 2026-01-14*
